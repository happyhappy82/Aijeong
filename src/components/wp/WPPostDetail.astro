---
import { formatDate } from "@/lib/utils";
import Badge from "@/components/ui/Badge.astro";

interface Props {
  title: string;
  content: string;
  date: string;
  modified: string;
  categorySlug: string;
  tags: string[];
  featuredImage: string | null;
  slug: string;
}

const { title, content, date, modified, categorySlug, tags, featuredImage, slug } = Astro.props;

// Get category display name from slug
const getCategoryName = (slug: string) => {
  const categoryMap: Record<string, string> = {
    'blog': '블로그',
    'casestudy': '교육사례',
    'education': '교육',
    'ai': 'AI',
    'news': '소식',
  };
  return categoryMap[slug] || slug;
};

// Determine back link based on category
const getBackLink = (categorySlug: string) => {
  if (categorySlug === 'casestudy') {
    return '/교육사례-2/';
  }
  return '/135-2/'; // blog default
};
---

<article class="py-12 md:py-20">
  <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
    <a
      href={getBackLink(categorySlug)}
      class="inline-flex items-center gap-1.5 text-sm text-muted-foreground hover:text-accent transition-colors mb-8"
    >
      <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="19" y1="12" x2="5" y2="12"></line>
        <polyline points="12 19 5 12 12 5"></polyline>
      </svg>
      목록으로
    </a>

    {featuredImage && (
      <div class="mb-8 rounded-2xl overflow-hidden">
        <img
          src={featuredImage}
          alt={title}
          class="w-full h-auto"
        />
      </div>
    )}

    <header class="mb-10">
      <Badge variant="accent" class="mb-4">
        {getCategoryName(categorySlug)}
      </Badge>
      <h1 class="text-3xl md:text-4xl font-bold leading-tight mb-6">
        {title}
      </h1>
      <div class="flex flex-wrap items-center gap-4 text-sm text-muted-foreground">
        <span class="flex items-center gap-1">
          <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
          {formatDate(date)}
        </span>
        {modified && modified !== date && (
          <span class="text-xs">
            (수정: {formatDate(modified)})
          </span>
        )}
      </div>
    </header>

    <hr class="border-border mb-10" />

    <div class="blog-content" set:html={content} />

    {tags && tags.length > 0 && (
      <div class="mt-12 pt-8 border-t border-border">
        <div class="flex flex-wrap gap-2">
          {tags.map((tag) => (
            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs bg-muted text-muted-foreground">
              #{tag}
            </span>
          ))}
        </div>
      </div>
    )}

    <div class="mt-12 pt-8 border-t border-border">
      <div class="flex items-center justify-between">
        <p class="text-sm text-muted-foreground">이 글이 도움이 되셨나요?</p>
        <div class="flex items-center gap-2">
          <button
            id="copy-link-btn"
            data-url={`https://aijeong.com/${slug}/`}
            class="flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-muted text-sm hover:bg-border transition-colors cursor-pointer"
          >
            <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
              <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
            </svg>
            <span class="copy-text">링크 복사</span>
          </button>
          <button
            id="share-twitter-btn"
            data-title={title}
            data-url={`https://aijeong.com/${slug}/`}
            class="flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-muted text-sm hover:bg-border transition-colors cursor-pointer"
          >
            <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z"></path>
            </svg>
            공유
          </button>
        </div>
      </div>
    </div>
  </div>
</article>

<script>
  // Copy link functionality
  const copyBtn = document.getElementById('copy-link-btn');
  if (copyBtn) {
    copyBtn.addEventListener('click', async () => {
      const url = copyBtn.getAttribute('data-url') || window.location.href;
      const textSpan = copyBtn.querySelector('.copy-text');

      try {
        await navigator.clipboard.writeText(url);
        if (textSpan) {
          textSpan.textContent = '복사됨!';
          setTimeout(() => {
            textSpan.textContent = '링크 복사';
          }, 2000);
        }
      } catch (err) {
        console.error('Failed to copy:', err);
      }
    });
  }

  // Twitter share functionality
  const twitterBtn = document.getElementById('share-twitter-btn');
  if (twitterBtn) {
    twitterBtn.addEventListener('click', () => {
      const title = twitterBtn.getAttribute('data-title');
      const url = twitterBtn.getAttribute('data-url');
      const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(title || '')}&url=${encodeURIComponent(url || '')}`;
      window.open(twitterUrl, '_blank');
    });
  }
</script>
